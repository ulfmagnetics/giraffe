{% extends "base.html" %}

{% block title %}{{ track.title }} - {{ site_title }}{% endblock %}

{% block extra_head %}
<meta property="og:title" content="{{ track.title }}">
<meta property="og:description" content="{{ track.category }} - {{ track.year }}">
<meta property="og:image" content="../covers/{{ track.cover_filename }}">
{% endblock %}

{% block content %}
<article class="track-detail">
    <div class="track-header">
        <div class="track-cover-large">
            {% if track.image_filenames|length > 1 %}
            {# Multiple images - show carousel #}
            <div class="carousel" data-carousel>
                <div class="carousel-images">
                    {% for img_filename in track.image_filenames %}
                    <img src="../covers/{{ img_filename }}"
                         alt="{{ track.title }} image {{ loop.index }}"
                         class="carousel-image {% if loop.first %}active{% endif %}">
                    {% endfor %}
                </div>
                <button class="carousel-btn carousel-prev" aria-label="Previous image">‹</button>
                <button class="carousel-btn carousel-next" aria-label="Next image">›</button>
                <div class="carousel-dots">
                    {% for img_filename in track.image_filenames %}
                    <button class="carousel-dot {% if loop.first %}active{% endif %}"
                            data-index="{{ loop.index0 }}"
                            aria-label="Go to image {{ loop.index }}"></button>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            {# Single image #}
            <img src="../covers/{{ track.cover_filename }}" alt="{{ track.title }} cover art">
            {% endif %}
        </div>

        <div class="track-metadata">
            <h1>{{ track.title }}</h1>

            <div class="meta-grid">
                {% if track.year %}
                <div class="meta-item">
                    <span class="meta-label">Year</span>
                    <span class="meta-value">{{ track.year }}</span>
                </div>
                {% endif %}

                {% if track.category %}
                <div class="meta-item">
                    <span class="meta-label">Category</span>
                    <span class="meta-value">{{ track.category }}</span>
                </div>
                {% endif %}

                <div class="meta-item">
                    <span class="meta-label">Status</span>
                    <span class="meta-value status-{{ track.status }}">{{ track.status|replace('-', ' ')|title }}</span>
                </div>

                {% if track.created %}
                <div class="meta-item">
                    <span class="meta-label">Created</span>
                    <span class="meta-value">{{ track.created }}</span>
                </div>
                {% endif %}
            </div>

            {% if track.tags %}
            <div class="track-tags">
                {% for tag in track.tags %}
                <span class="tag">{{ tag }}</span>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>

    {% if track.mp3_url %}
    <div class="audio-player">
        <h2>Listen</h2>
        <audio controls preload="metadata">
            <source src="{{ track.mp3_url }}" type="audio/mpeg">
            Your browser does not support the audio element.
        </audio>

        <div class="download-links">
            <a href="{{ track.mp3_url }}" download class="btn btn-secondary">Download MP3</a>
            {% if track.wav_url %}
            <a href="{{ track.wav_url }}" download class="btn btn-secondary">Download WAV (High Quality)</a>
            {% endif %}
        </div>
    </div>
    {% endif %}

    {% if track.content %}
    <div class="track-content">
        {{ track.content|safe }}
    </div>
    {% endif %}

    <div class="track-navigation">
        <a href="../index.html" class="btn btn-primary">← Back to all tracks</a>
    </div>
</article>

{# Lightbox for full-size image viewing #}
<div id="lightbox" class="lightbox" style="display: none;">
    <button class="lightbox-close" aria-label="Close lightbox">&times;</button>
    <div class="lightbox-content">
        <img id="lightbox-image" src="" alt="">
        {% if track.image_filenames|length > 1 %}
        <button class="lightbox-btn lightbox-prev" aria-label="Previous image">‹</button>
        <button class="lightbox-btn lightbox-next" aria-label="Next image">›</button>
        {% endif %}
    </div>
</div>
{% endblock %}
